{
  "info": {
    "name": "ZozoMart - PayPal Flow",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Login (User)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/x-www-form-urlencoded" }
        ],
        "url": "{{baseUrl}}/login",
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            { "key": "email", "value": "user@example.com" },
            { "key": "password", "value": "user123" }
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status code is 200', () => pm.response.to.have.status(200));",
              "const setCookie = pm.response.headers.get('Set-Cookie') || pm.response.headers.get('set-cookie');",
              "if (setCookie) { const m = setCookie.match(/connect\\.sid=([^;]+)/); if (m) pm.environment.set('userCookie', 'connect.sid=' + m[1]); }"
            ]
          }
        }
      ]
    },
    {
      "name": "PayPal Create Order (App)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Cookie", "value": "{{userCookie}}" }
        ],
        "url": "{{baseUrl}}/api/paypal/create-order",
        "body": { "mode": "raw", "raw": "{}" }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status code is 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.test('success true', () => pm.expect(json.success).to.eql(true));",
              "if (json.orderId) pm.environment.set('paypalOrderId', json.orderId);"
            ]
          }
        }
      ]
    },
    {
      "name": "PayPal Capture Order (App)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Cookie", "value": "{{userCookie}}" }
        ],
        "url": "{{baseUrl}}/api/paypal/capture-order",
        "body": { "mode": "raw", "raw": "{\"orderID\": \"{{paypalOrderId}}\"}" }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status code is 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.test('success true', () => pm.expect(json.success).to.eql(true));"
            ]
          }
        }
      ]
    }
  ]
}
