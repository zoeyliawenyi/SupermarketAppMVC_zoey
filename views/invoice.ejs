<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice #<%= order.id %> | ZozoMart</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
    * { box-sizing: border-box; }
    body { font-family:'Roboto',sans-serif; margin:0; padding:24px; color:#111; background:#f9fafb; }
    .invoice { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; max-width:900px; margin:0 auto; box-shadow:0 8px 24px rgba(0,0,0,0.06); }
    .header { display:flex; justify-content:space-between; align-items:flex-start; border-bottom:1px solid #e5e7eb; padding-bottom:14px; }
    .brand { font-weight:700; font-size:22px; }
    .meta { text-align:right; font-size:12px; color:#555; }
    h2 { margin:14px 0 6px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:10px; border-bottom:1px solid #e5e7eb; text-align:left; font-size:14px; }
    th { background:#f3f4f6; font-weight:700; }
    .totals td { font-weight:700; }
    .foot { margin-top:18px; font-size:12px; color:#666; text-align:center; }
    .addr { font-size:13px; line-height:1.5; }
  </style>
</head>
<body onload="window.print()">
  <div class="invoice">
    <div class="header">
      <div>
        <div class="brand">ZozoMart</div>
        <div class="addr">
          123 Market Street<br>
          Singapore 123456<br>
          Tel: +65 6000 0000
        </div>
      </div>
      <div class="meta">
        <div><strong>Invoice #</strong> <%= order.id %></div>
        <div><strong>Date</strong> <%= order.createdAt ? (order.createdAt.toLocaleString ? order.createdAt.toLocaleString() : order.createdAt) : '' %></div>
        <div><strong>Payment</strong> <%= order.paymentMethod || '-' %></div>
        <div><strong>Shipping</strong> <%= order.deliveryType || '-' %></div>
        <div><strong>Status</strong> <%= order.status || 'placed' %></div>
      </div>
    </div>

    <div style="display:flex; gap:20px; margin-top:14px; flex-wrap:wrap;">
      <div style="flex:1;">
        <h3 style="margin:0 0 6px;">Bill To</h3>
        <div class="addr">
          <%= user && user.username ? user.username : 'Customer' %><br>
          <%= order.address || 'No address provided' %>
        </div>
      </div>
      <div style="flex:1;">
        <h3 style="margin:0 0 6px;">Ship To</h3>
        <div class="addr">
          <%= order.address || 'No address provided' %>
        </div>
      </div>
    </div>

    <h2>Items</h2>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <% if (!items || !items.length) { %>
          <tr><td colspan="4" style="text-align:center; color:#666; font-size:13px;">No items found for this order.</td></tr>
        <% } else { %>
          <% items.forEach(function(it){ %>
            <tr>
              <td><%= it.productName || ('Item #' + it.productId) %></td>
              <td><%= it.quantity %></td>
              <td>$<%= Number(it.price).toFixed(2) %></td>
              <td>$<%= (Number(it.price)*Number(it.quantity)).toFixed(2) %></td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>

    <table style="margin-top:10px;">
      <tbody class="totals">
        <tr>
          <td style="text-align:right;">Items subtotal</td>
          <td style="text-align:right; width:120px;">$<%= itemsSubtotal.toFixed(2) %></td>
        </tr>
        <tr>
          <td style="text-align:right;">Shipping</td>
          <td style="text-align:right;">$<%= shippingFee.toFixed(2) %></td>
        </tr>
        <tr>
          <td style="text-align:right;">Order total</td>
          <td style="text-align:right;">$<%= total.toFixed(2) %></td>
        </tr>
      </tbody>
    </table>

    <div class="foot">Thank you for shopping with ZozoMart.</div>
  </div>
</body>
</html>
