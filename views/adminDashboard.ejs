<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZozoMart | Admin Dashboard</title>
  <style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
:root {
  --bg:#ffffff;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
  --shadow:0 12px 30px rgba(17,24,39,0.08);
  --radius:14px;
  --pink:#f8cde5;
  --blue:#c8d9ff;
  --purple:#d6c8ff;
  --mint:#c8f0df;
}
*{box-sizing:border-box;}
body{margin:0;font-family:'Poppins',sans-serif;background:radial-gradient(circle at 20% 20%, rgba(255,92,138,0.08), transparent 35%),radial-gradient(circle at 80% 10%, rgba(255,143,177,0.12), transparent 32%),linear-gradient(135deg,#ffffff,#fdf3f7 45%,#ffffff);color:var(--text);} 
.shell{max-width:1400px;margin:0 auto;padding:24px;}
.nav{display:flex;align-items:center;justify-content:space-between;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px 18px;box-shadow:var(--shadow);} 
.brand{display:flex;align-items:center;gap:10px;font-weight:700;} 
.brand .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(135deg,#ff5c8a,#ff8fb1);box-shadow:0 0 10px rgba(255,92,138,0.6);} 
.nav-links{display:flex;gap:12px;align-items:center;flex-wrap:wrap;} 
.nav-links a{padding:8px 12px;border-radius:10px;color:var(--text);font-weight:500;text-decoration:none;} 
.nav-links a:hover{background:rgba(255,92,138,0.08);} 
.user-menu{position:relative;} 
.user-menu summary{list-style:none;cursor:pointer;padding:8px 12px;border-radius:10px;} 
.user-menu[open] summary,.user-menu summary:hover{background:rgba(255,92,138,0.08);} 
.user-menu .dropdown{position:absolute;right:0;top:110%;background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);min-width:140px;padding:8px 0;z-index:20;} 
.user-menu .dropdown a{display:block;padding:8px 12px;color:var(--text);text-decoration:none;} 
.user-menu .dropdown a:hover{background:rgba(255,92,138,0.08);} 

.section-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-top:16px;margin-bottom:12px;} 
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;} 
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;} 
.stat-label{color:var(--muted);font-size:13px;} 
.stat-value{font-size:28px;font-weight:700;margin-top:6px;} 

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:14px;} 
.chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;}
.chart-card canvas { width:100% !important; height:240px !important; }
.table-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-top:14px;} 
.table{width:100%;border-collapse:collapse;} 
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap;} 
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px;background:var(--blue);} 
.muted{color:var(--muted);} 
.btn{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer;text-decoration:none;font-weight:600;} 
.btn.primary{background:linear-gradient(135deg,#f11d92,#fb7da7);color:#fff;border:none;} 

.quick-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:12px;} 
.quick-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;display:flex;justify-content:space-between;align-items:center;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body>
  <div class="shell">
    <nav class="nav">
      <div class="brand">
        <span class="dot"></span>
        ZozoMart
      </div>
      <div class="nav-links">
        <a href="/admin/dashboard">Dashboard</a>
        <a href="/inventory">Inventory</a>
        <a href="/admin/users">Users</a>
        <a href="/admin/orders">Orders</a>
        <a href="/admin/reviews">Reviews</a>
        <details class="user-menu">
          <summary>ðŸ‘¤ <%= user.username %> â–¾</summary>
          <div class="dropdown">
            <a href="/logout">Logout</a>
          </div>
        </details>
      </div>
    </nav>


    <div class="section-head">
      <div>
        <p class="muted" style="margin:0; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#2563eb;">Admin</p>
        <h2 style="margin:4px 0 0;">Dashboard</h2>
        <p class="muted" style="margin:4px 0 0;">Monitor store performance, users, and orders at a glance.</p>
      </div>
      <div class="quick-grid" style="max-width:420px;">
        <div class="quick-card"><span class="muted">Manage</span><a class="btn" href="/inventory">Inventory</a></div>
        <div class="quick-card"><span class="muted">Users</span><a class="btn" href="/admin/users">Users</a></div>
        <div class="quick-card"><span class="muted">Orders</span><a class="btn" href="/admin/orders">Orders</a></div>
      </div>
    </div>

    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-label">Products</div>
        <div class="stat-value"><%= stats.products %></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Users</div>
        <div class="stat-value"><%= stats.users %></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Orders</div>
        <div class="stat-value"><%= stats.orders %></div>
      </div>
    </div>

    <% if (stats.lowStock && stats.lowStock.length) { %>
    <div id="lowstock" class="table-card" style="margin-top:12px; border-left:4px solid #f59e0b;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <h3 style="margin:0;">Low stock alerts</h3>
        <span class="muted" style="font-weight:600;"><%= stats.lowStock.length %> item(s) below 20</span>
      </div>
      <table class="table" style="margin-top:8px;">
        <thead><tr><th>Product</th><th>Stock</th></tr></thead>
        <tbody>
          <% stats.lowStock.forEach(function(p){ %>
            <tr>
              <td><%= p.productName %></td>
              <td style="color:#b91c1c; font-weight:700;"><%= p.stock %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>

    <div class="grid-2">
      <div class="chart-card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="margin:0;">Ratings distribution</h3>
          <span class="muted" style="font-weight:600;">All reviews</span>
        </div>
        <canvas id="ratingChart" height="220"></canvas>
      </div>
      <div class="chart-card">
        <h3 style="margin:0;">Status mix</h3>
        <canvas id="statusChart" height="220"></canvas>
      </div>
    </div>

    <div class="table-card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <h3 style="margin:0;">Recent orders</h3>
        <a class="btn" href="/admin/orders">View all</a>
      </div>
      <table class="table" style="margin-top:8px;">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Status</th>
            <th>Total</th>
            <th>Placed</th>
          </tr>
        </thead>
        <tbody>
          <% (stats.recentOrders || []).forEach(function(o){ %>
            <tr>
              <td>#<%= o.id %></td>
              <td><%= o.username || ('User ' + (o.userId||'')) %></td>
              <td><span class="badge"><%= o.status || 'placed' %></span></td>
              <td>$ <%= Number(o.total).toFixed(2) %></td>
              <td><%= o.createdAt ? (o.createdAt.toLocaleString ? o.createdAt.toLocaleString() : o.createdAt) : '-' %></td>
            </tr>
          <% }) %>
          <% if (!stats.recentOrders || !stats.recentOrders.length) { %>
            <tr><td colspan="5" class="muted">No recent orders.</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <div class="table-card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <h3 style="margin:0;">Recent reviews</h3>
        <a class="btn" href="/admin/reviews">Manage reviews</a>
      </div>
      <table class="table" style="margin-top:8px;">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Product</th>
            <th>Rating</th>
            <th>Comment</th>
          </tr>
        </thead>
        <tbody>
          <% (stats.recentReviews || []).forEach(function(r){ %>
            <tr>
              <td>#<%= r.id %></td>
              <td><%= r.username || ('User ' + (r.userId||'')) %></td>
              <td><%= r.productName || ('Product ' + (r.productId||'')) %></td>
              <td><%= 'â˜…'.repeat(r.rating || 0).padEnd(5,'â˜†') %></td>
              <td class="muted"><%= r.comment || '' %></td>
            </tr>
          <% }) %>
          <% if (!stats.recentReviews || !stats.recentReviews.length) { %>
            <tr><td colspan="5" class="muted">No recent reviews.</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    (function(){
      const orders = <%- JSON.stringify(stats.recentOrders || []) %>;
      const ratingSummary = <%- JSON.stringify(stats.ratingSummary || []) %>;
      const statusColors = {
        'payment successful': '#c8d9ff',
        'payment failed': '#f8cde5',
        'packing': '#ffe4c7',
        'ready for pickup': '#d6c8ff',
        'out for delivery': '#c8f0df',
        'completed': '#bde7f5',
      };

      // Ratings pie
      const ratingCtx = document.getElementById('ratingChart');
      const ratingCounts = [1,2,3,4,5].map(n => {
        const row = ratingSummary.find(r => Number(r.rating) === n);
        return row ? Number(row.count) : 0;
      });
      new Chart(ratingCtx, {
        type:'pie',
        data:{
          labels:['1 star','2 stars','3 stars','4 stars','5 stars'],
          datasets:[{
            data: ratingCounts,
            backgroundColor:['#eaff00','#742bd4','#3c43c3','#f50aec','#0ff049']
          }]
        },
        options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' }, datalabels:{ color:'#1f2937', formatter:(v)=> v>0 ? v : '' } } },
        plugins:[ChartDataLabels]
      });

      const statusCtx=document.getElementById('statusChart');
      const legend=['payment successful','payment failed','packing','ready for pickup','out for delivery','completed'];
      const counts={}; legend.forEach(l=>counts[l]=0);
      orders.forEach(o=>{const s=(o.status||'placed').toLowerCase(); if(counts.hasOwnProperty(s)) counts[s]++;});
      new Chart(statusCtx,{type:'pie',data:{labels:legend,datasets:[{data:legend.map(l=>counts[l]),backgroundColor:legend.map(l=>statusColors[l]||'#e4e7ff')}]} ,options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'},datalabels:{color:'#1f2937',formatter:(v)=> v>0 ? v : ''}}},plugins:[ChartDataLabels]});
    })();
  </script>
</body>
</html>
